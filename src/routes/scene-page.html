<section class="space-y-4">
  <mdui-card class="glass p-4 flex items-center justify-between">
    <div class="text-xl font-semibold">Scene</div>
    <div class="flex items-center gap-2">
      <mdui-button variant="tonal" icon="ios_share" click.trigger="publish()" disabled.bind="publishing">${publishing ? 'Publishingâ€¦' : 'Publish'}</mdui-button>
      <template if.bind="publicUrl">
        <mdui-chip clickable="true" href.bind="publicUrl">Share: ${publicUrl}</mdui-chip>
      </template>
    </div>
  </mdui-card>

  <mdui-card class="glass popover-safe p-4 space-y-3">
    <div class="grid gap-2 md:grid-cols-3 items-end">
      <mdui-select label="Era" value.two-way="selectedEra" change.trigger="selectExisting()">
        <mdui-menu-item value="1890">1890</mdui-menu-item>
        <mdui-menu-item value="1920">1920</mdui-menu-item>
        <mdui-menu-item value="1940">1940</mdui-menu-item>
        <mdui-menu-item value="1970">1970</mdui-menu-item>
        <mdui-menu-item value="1980">1980</mdui-menu-item>
        <mdui-menu-item value="1990">1990</mdui-menu-item>
        <mdui-menu-item value="2000">2000</mdui-menu-item>
        <mdui-menu-item value="2010">2010</mdui-menu-item>
        <mdui-menu-item value="2090">2090</mdui-menu-item>
      </mdui-select>
      <mdui-select label="Variant" value.two-way="selectedVariant" change.trigger="selectExisting()">
        <mdui-menu-item value="mild">Mild</mdui-menu-item>
        <mdui-menu-item value="balanced">Balanced</mdui-menu-item>
        <mdui-menu-item value="cinematic">Cinematic</mdui-menu-item>
      </mdui-select>
      <div class="flex gap-2 justify-end">
        <mdui-button variant="filled" icon="bolt" click.trigger="generate()">Generate</mdui-button>
        <mdui-button variant="tonal" icon="autorenew" click.trigger="reroll()">Reroll</mdui-button>
      </div>
    </div>
  </mdui-card>

  <mdui-card class="glass popover-safe p-4 space-y-3">
    <h3 class="text-lg font-semibold flex items-center gap-2">
      <mdui-icon name="compare"></mdui-icon>
      Before / After
    </h3>
    <!-- Compare mode: only when both images exist -->
    <template if.bind="originalUrl && resultUrl">
      <div class="relative w-full max-w-full overflow-hidden rounded-xl checker ring-1 ring-black/5 cursor-col-resize select-none"
           pointerdown.trigger="onSliderStart($event)"
           pointermove.trigger="onSliderMove($event)"
           pointerup.trigger="onSliderEnd()"
           pointerleave.trigger="onSliderEnd()">
        <img class="block w-full select-none" src.bind="originalUrl" alt="Original"/>
        <img class="absolute top-0 left-0 w-full h-auto select-none" src.bind="resultUrl" alt="Result"
             style.bind="'clip-path: inset(0 ' + (100 - compare) + '% 0 0)'"/>
        <div class="absolute inset-y-0" style.bind="'left: ' + compare + '%'">
          <div class="-translate-x-1/2 w-0.5 h-full bg-white/80 shadow"></div>
          <div class="absolute top-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-white shadow ring-1 ring-black/10"></div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <input type="range" min="0" max="100" value.two-way="compare" />
        <span class="text-xs opacity-70">${compare}%</span>
      </div>
      <div class="flex flex-wrap gap-2">
        <mdui-button variant="tonal" icon="zoom_in" click.trigger="openModal()">View larger</mdui-button>
        <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
      </div>

      <template if.bind="modalOpen">
        <div class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" click.trigger="closeModal()" portal>
          <div class="relative w-full max-w-5xl" click.trigger="noop($event)">
            <div class="relative w-full overflow-hidden rounded-xl checker ring-1 ring-black/20 cursor-col-resize"
                 pointerdown.trigger="onSliderStart($event)"
                 pointermove.trigger="onSliderMove($event)"
                 pointerup.trigger="onSliderEnd()"
                 pointerleave.trigger="onSliderEnd()">
              <img class="block w-full select-none" src.bind="originalUrl" alt="Original large"/>
              <img class="absolute top-0 left-0 w-full h-auto select-none" src.bind="resultUrl" alt="Result large"
                   style.bind="'clip-path: inset(0 ' + (100 - compare) + '% 0 0)'"/>
              <div class="absolute inset-y-0" style.bind="'left: ' + compare + '%'">
                <div class="-translate-x-1/2 w-0.5 h-full bg-white/80 shadow"></div>
                <div class="absolute top-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-white shadow ring-1 ring-black/10"></div>
              </div>
            </div>
            <div class="mt-3 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <input type="range" min="0" max="100" value.two-way="compare" />
                <span class="text-xs opacity-70">${compare}%</span>
              </div>
              <div class="flex gap-2">
                <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
                <mdui-button variant="filled" icon="close" click.trigger="closeModal()">Close</mdui-button>
              </div>
            </div>
          </div>
        </div>
      </template>
    </template>

    <!-- Single image fallback: show whichever exists to avoid collapsing height -->
    <template if.bind="!originalUrl && resultUrl">
      <img class="rounded-xl w-full ring-1 ring-black/5" src.bind="resultUrl" alt="Result"/>
      <div class="flex flex-wrap gap-2">
        <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
      </div>
    </template>
    <template if.bind="originalUrl && !resultUrl">
      <img class="rounded-xl w-full ring-1 ring-black/5" src.bind="originalUrl" alt="Original"/>
      <div class="flex flex-wrap gap-2">
        <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
      </div>
    </template>
    <template if.bind="!originalUrl && !resultUrl">
      <div class="text-sm opacity-70">No images yet.</div>
    </template>
  </mdui-card>
</section>
