<section class="grid gap-4 md:grid-cols-3">
  <mdui-card class="p-4 md:col-span-2 space-y-3">
    <h2 class="text-xl font-semibold flex items-center gap-2">
      <mdui-icon name="tune"></mdui-icon>
      Generate
    </h2>

    <div class="grid gap-3 md:grid-cols-2">
      <div class="space-y-2">
        <div class="text-sm opacity-70">Upload photo</div>
        <input type="file" accept="image/jpeg,image/png,image/webp" change.trigger="onPickSource($event)"/>
        <template if.bind="sourcePreview">
          <img class="rounded-lg max-h-48" src.bind="sourcePreview" alt="Source preview"/>
        </template>
      </div>

      <div class="space-y-2">
        <div class="text-sm opacity-70">Era, intensity, and style</div>
        <div class="flex gap-2 items-center">
          <mdui-select label="Era" value.two-way="era">
            <mdui-menu-item value="1890">1890</mdui-menu-item>
            <mdui-menu-item value="1920">1920</mdui-menu-item>
            <mdui-menu-item value="1940">1940</mdui-menu-item>
            <mdui-menu-item value="1970">1970</mdui-menu-item>
            <mdui-menu-item value="1980">1980</mdui-menu-item>
            <mdui-menu-item value="1990">1990</mdui-menu-item>
            <mdui-menu-item value="2000">2000</mdui-menu-item>
            <mdui-menu-item value="2010">2010</mdui-menu-item>
            <mdui-menu-item value="2090">2090</mdui-menu-item>
          </mdui-select>
          <mdui-select label="Intensity" value.two-way="variant">
            <mdui-menu-item value="mild">Mild</mdui-menu-item>
            <mdui-menu-item value="balanced">Balanced</mdui-menu-item>
            <mdui-menu-item value="cinematic">Cinematic</mdui-menu-item>
          </mdui-select>
        </div>
        <mdui-select label="Style (optional)" value.two-way="stylePreset">
          <mdui-menu-item value="">None</mdui-menu-item>
          <mdui-menu-item value="Noir black-and-white with deep contrast">Noir B&W</mdui-menu-item>
          <mdui-menu-item value="Faded postcard toning and soft vignette">Faded Postcard</mdui-menu-item>
          <mdui-menu-item value="VHS cassette artifacts and slight chroma bleed">VHS 90s</mdui-menu-item>
          <mdui-menu-item value="Polaroid instant film look">Polaroid 70s</mdui-menu-item>
          <mdui-menu-item value="Cyberpunk neon glow and reflective materials">Cyberpunk</mdui-menu-item>
          <mdui-menu-item value="Kodachrome film palette and grain">Kodachrome</mdui-menu-item>
          <mdui-menu-item value="Sepia tone and paper texture">Sepia 1900s</mdui-menu-item>
        </mdui-select>
        <mdui-text-field label="Negatives (optional)" value.two-way="negatives" type="textarea"></mdui-text-field>
        <div class="flex gap-2">
          <mdui-button variant="tonal" icon="shuffle" click.trigger="randomize()">Surprise me</mdui-button>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2">
      <mdui-button variant="filled" icon="bolt" disabled.bind="busy || !sourceFile || !auth.currentUser" click.trigger="generate()">Generate</mdui-button>
      <template if.bind="busy">
        <mdui-circular-progress indeterminate></mdui-circular-progress>
      </template>
      <template if.bind="error">
        <div class="text-sm text-red-600">${error}</div>
      </template>
      <template if.bind="quota">
        <mdui-chip clickable="false" class="text-sm">
          <mdui-icon name="bolt" slot="icon"></mdui-icon>
          ${quota.dailyRequests} / ${quota.dailyLimit} today ${auth.isAnonymous ? '(Guest)' : ''}
        </mdui-chip>
      </template>
    </div>
  </mdui-card>

  <mdui-card class="p-4 space-y-3">
    <h3 class="text-lg font-semibold flex items-center gap-2">
      <mdui-icon name="image"></mdui-icon>
      Result
    </h3>
    <template if.bind="resultImage">
      <div class="relative w-full max-w-full overflow-hidden rounded-lg border">
        <img class="block w-full" src.bind="sourcePreview || ''" alt="Original"/>
        <div class="absolute inset-0 pointer-events-none overflow-hidden" style.bind="'width: ' + compare + '%'">
          <img class="w-full h-full object-contain" src.bind="resultImage" alt="Result"/>
        </div>
        <div class="absolute inset-y-0" style.bind="'left: ' + compare + '%'">
          <div class="w-0.5 h-full bg-white/70 shadow"></div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <input type="range" min="0" max="100" value.two-way="compare" />
        <span class="text-xs opacity-70">${compare}%</span>
      </div>
      <div class="flex gap-2">
        <mdui-button variant="tonal" icon="autorenew" disabled.bind="busy || !sceneId" click.trigger="reroll()">Reroll</mdui-button>
        <mdui-button variant="tonal" icon="download" click.trigger="downloadResult()">Download</mdui-button>
      </div>
    </template>
    <template if.bind="!resultImage">
      <div class="text-sm opacity-70">No result yet</div>
    </template>
  </mdui-card>
</section>
