<section class="space-y-4">
  <mdui-card class="glass p-4">
    <h2 class="text-xl font-semibold">Shared Scene</h2>
  </mdui-card>

  <template if.bind="error">
    <mdui-card class="glass p-3 text-sm text-red-600">${error}</mdui-card>
  </template>

  <mdui-card class="glass popover-safe p-4 space-y-3">
    <h3 class="text-lg font-semibold flex items-center gap-2">
      <mdui-icon name="compare"></mdui-icon>
      Before / After
    </h3>

    <!-- Compare when both images are available -->
    <template if.bind="originalUrl && resultUrl">
      <div class="relative w-full max-w-full overflow-hidden rounded-xl checker ring-1 ring-black/5 cursor-col-resize select-none"
           pointerdown.trigger="onSliderStart($event)"
           pointermove.trigger="onSliderMove($event)"
           pointerup.trigger="onSliderEnd()"
           pointerleave.trigger="onSliderEnd()">
        <img class="block w-full select-none" src.bind="originalUrl" alt="Original"/>
        <img class="absolute top-0 left-0 w-full h-auto select-none" src.bind="resultUrl" alt="Result" error.trigger="resultUrl = null"
             style.bind="'clip-path: inset(0 ' + (100 - compare) + '% 0 0)'"/>
        <div class="absolute inset-y-0" style.bind="'left: ' + compare + '%'">
          <div class="-translate-x-1/2 w-0.5 h-full bg-white/80 shadow"></div>
          <div class="absolute top-1/2 -translate-x-1/2 -translate-y-1/2 w-5 h-5 rounded-full bg-white shadow ring-1 ring-black/10"></div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <input type="range" min="0" max="100" value.two-way="compare" />
        <span class="text-xs opacity-70">${compare}%</span>
      </div>
      <div class="flex flex-wrap gap-2">
        <mdui-button variant="tonal" icon="zoom_in" click.trigger="openModal()">View larger</mdui-button>
        <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
      </div>

      <template if.bind="modalOpen">
        <div class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" click.trigger="closeModal()" portal>
          <div class="relative w-full max-w-5xl" click.trigger="noop($event)">
            <div class="relative w-full overflow-hidden rounded-xl checker ring-1 ring-black/20 cursor-col-resize"
                 pointerdown.trigger="onSliderStart($event)"
                 pointermove.trigger="onSliderMove($event)"
                 pointerup.trigger="onSliderEnd()"
                 pointerleave.trigger="onSliderEnd()">
              <img class="block w-full select-none" src.bind="originalUrl" alt="Original large"/>
              <img class="absolute top-0 left-0 w-full h-auto select-none" src.bind="resultUrl" alt="Result large" error.trigger="resultUrl = null"
                   style.bind="'clip-path: inset(0 ' + (100 - compare) + '% 0 0)'"/>
              <div class="absolute inset-y-0" style.bind="'left: ' + compare + '%'">
                <div class="-translate-x-1/2 w-0.5 h-full bg-white/80 shadow"></div>
                <div class="absolute top-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-white shadow ring-1 ring-black/10"></div>
              </div>
            </div>
            <div class="mt-3 flex items-center justify-between">
              <div class="flex items-center gap-2">
                <input type="range" min="0" max="100" value.two-way="compare" />
                <span class="text-xs opacity-70">${compare}%</span>
              </div>
              <div class="flex gap-2">
                <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
                <mdui-button variant="filled" icon="close" click.trigger="closeModal()">Close</mdui-button>
              </div>
            </div>
          </div>
        </div>
      </template>
    </template>

    <!-- Single image fallbacks -->
    <template if.bind="!originalUrl && resultUrl">
      <img class="rounded-xl w-full ring-1 ring-black/5" src.bind="resultUrl" alt="Result"/>
      <div class="flex flex-wrap gap-2">
        <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
      </div>
    </template>
    <template if.bind="originalUrl && !resultUrl">
      <img class="rounded-xl w-full ring-1 ring-black/5" src.bind="originalUrl" alt="Original"/>
      <div class="flex flex-wrap gap-2">
        <mdui-button variant="tonal" icon="download" click.trigger="downloadSelected()">Download</mdui-button>
      </div>
    </template>
    <template if.bind="!originalUrl && !resultUrl && !error">
      <div class="text-sm opacity-70">Loadingâ€¦</div>
    </template>
  </mdui-card>
</section>
